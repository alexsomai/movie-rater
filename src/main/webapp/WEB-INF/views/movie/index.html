<!DOCTYPE html>
<html layout:decorator="fragments/main_layout">
<head>
    <title>View movies</title>
    <script th:inline="javascript">
        // <![CDATA[
        $(document).ready(function () {
            $.getJSON("/category/getAll", function (result) {
                var categories = $('#categories'),
                        categoriesArray = [],
                        title, sort, order;

                /*[+
                 categoriesArray = [[${#arrays.toArray(searchFilter.category)}]];
                 title = [[${searchFilter?.title}]];
                 sort = [[${searchFilter?.sort}]];
                 order = [[${searchFilter?.order}]];
                 +]*/

                if (title == null) {
                    title = "";
                }

                categoriesArray = categoriesArray.filter(Number);

                $.each(result, function (index, item) {
                    var color = '#d9534f';
                    if (item.id % 2 == 0) {
                        color = '#f0ad4e';
                    }
                    if (item.id % 3 == 0) {
                        color = '#446e9b';
                    }
                    if (item.id % 4 == 0) {
                        color = '#5cb85c';
                    }

                    var categoriesList = createCategoriesList(item.id, categoriesArray);

                    categories.append($("<li id='category-" +
                            item.id + "' class='label-filter-item " + categoriesList.active + "' >" +
                            "<a href='/movie/index?category=" + categoriesList.categoriesArrayUrl +
                            "&title=" + title + "&sort=" + sort + "&order=" + order +
                            "'><span class='label color-label' " +
                            "style='font-size: 12px; background:" + color + "; color:#FFF'>" +
                            item.genre + "</span>" + categoriesList.extraDiv + "</a></li>"
                    ));
                });
            });
        });

        function createCategoriesList(categoryId, categoriesArray) {
            var categoryIndex = $.inArray(categoryId, categoriesArray),
                    categoriesArrayUrl = categoriesArray.slice(),
                    category = {
                        active: "light",
                        extraDiv: "",
                        categoriesArrayUrl: categoriesArrayUrl
                    };
            if (categoryIndex == -1) {
                categoriesArrayUrl.push(categoryId);
            } else {
                categoriesArrayUrl.splice(categoryIndex, 1);
                category.active = "active";
                category.extraDiv = "<div class='pull-right'>" +
                "<i class='glyphicon glyphicon-remove'></div>";
            }

            return category;
        }

        // ]]>
    </script>
</head>
<body>
<div layout:fragment="content">
    <div class="row">
        <div class="col-md-2">
            <legend>Categories</legend>
            <ul id="categories" class="nav nav-pills nav-stacked nav-small labels-filter">
            </ul>
        </div>
        <div class="col-md-8">
            <div class="row">
                <div class="dropdown prepend-left-15">
                    <a class="btn btn-default dropdown-toggle" data-toggle="dropdown" href="#">
                        <span class="text-muted">sort:</span>
                        <span th:text="${searchFilter.sort eq 'rate'} ? (${searchFilter.order eq 'asc'} ? 'Lowest rate' : 'Highest rate') : ''"></span>
                        <span th:text="${searchFilter.sort eq 'numberOfRatings'} ? (${searchFilter.order eq 'asc'} ? 'Less voted' : 'Most voted') : ''"></span>
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="#"
                               th:href="@{/movie/index(title=${searchFilter?.title},
                                               page=${searchFilter?.page}, sort='rate', order='desc',
                                               category=${#arrays.toArray(searchFilter?.category)})}">
                                <i class="glyphicon glyphicon-circle-arrow-up"></i> Highest rate
                            </a>
                            <a href="#"
                               th:href="@{/movie/index(title=${searchFilter?.title},
                                               page=${searchFilter?.page}, sort='rate', order='asc',
                                               category=${#arrays.toArray(searchFilter?.category)})}">
                                Lowest rate <i class="glyphicon glyphicon-circle-arrow-down"></i>
                            </a>
                            <a href="#"
                               th:href="@{/movie/index(title=${searchFilter?.title},
                                               page=${searchFilter?.page}, sort='numberOfRatings', order='desc',
                                               category=${#arrays.toArray(searchFilter?.category)})}">
                                <i class="glyphicon glyphicon-circle-arrow-up"></i> Most voted
                            </a>
                            <a href="#"
                               th:href="@{/movie/index(title=${searchFilter?.title},
                                               page=${searchFilter?.page}, sort='numberOfRatings', order='asc',
                                               category=${#arrays.toArray(searchFilter?.category)})}">
                                Less voted <i class="glyphicon glyphicon-circle-arrow-down"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6 col-md-4 top3" th:each="movie : ${movies}">
                    <div class="thumbnail">
                        <table>
                            <tbody>
                            <tr>
                                <td>
                                    <img class="thumbnail-image"
                                         src="" onError="this.src='/resources/images/default_poster.jpg'"
                                         width="120"
                                         th:attr="src=${movie.posterFile}"/>
                                    <!--<img data-src="holder.js/100%x180" alt="..."/>-->
                                </td>
                                <td>
                                    <div th:inline="text">
                                        <h3>
                                            <strong>
                                                [[${movie.title}]]
                                            </strong>
                                        </h3>
                                        <h4><em>Rate</em></h4>
                                        [[${movie.rate}]]
                                        <span class="text-muted">/5</span> <span
                                            class="glyphicon glyphicon-star"></span>
                                        ([[${movie.numberOfRatings}]] votes)
                                        <h4><em>Release date</em></h4>
                                        [[${#dates.format(movie.releaseDate, 'MMMM dd, yyyy')}]]
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                        <div class="caption">
                            <h4><em>Genre</em></h4>
                            <ul>
                                <li th:each="genre : ${movie.genreNames}" th:text="${genre}"></li>
                            </ul>
                            <h4><em>Description</em></h4>

                            <p th:text="${movie.description}"></p>

                            <p>
                                <a href="#" th:href="@{/movie/edit(movieId=${movie.id})}"
                                   class="btn btn-primary" role="button">Edit
                                </a>
                                <a href="#" class="btn btn-danger" role="button">Delete</a>
                            </p>

                            <p>
                                <a class="btn btn-default" href="#" th:href="@{/movie/view(id=${movie.id})}">
                                    View details &raquo;
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div th:replace="fragments/pagination :: pagination(searchFilter = ${searchFilter})">
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>